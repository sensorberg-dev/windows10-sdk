<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>d:\work\sensorberg\windows10-sdk\sensorbergsdk\internal\data\sdkdata.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Diagnostics;
using Windows.Storage;

namespace SensorbergSDK.Internal
{
    /// &lt;summary&gt;
    /// Contains the global SDK data.
    /// &lt;/summary&gt;
    public sealed class SDKData
    {
        private const string KeySensorbergSdkApiKey = &quot;sensorberg_sdk_api_key&quot;;
        private const string KeySensorbergSdkGuid = &quot;sensorberg_sdk_guid&quot;;
        private const string KeyLayoutBeaconId1Hash = &quot;sensorberg_sdk_layout_uuid_hash&quot;;
        private const string KeyDatabaseCleaningTime = &quot;sensorberg_sdk_database_cleaning_time&quot;;
        private const string KeyBackgroundTaskEnabled = &quot;sensorberg_sdk_background_task_enabled&quot;;
        private const string KeyNewActionsFromBackground = &quot;sensorberg_sdk_new_actions_from_background&quot;;
        private const string KeyBackgroundFilterUpdateRequired = &quot;sensorberg_sdk_background_filter_update_required&quot;;
        private const string KeyIncrementalId = &quot;sensorberg_sdk_incremental_id&quot;;
        private const string KeyAppIsVisible = &quot;sensorberg_sdk_app_visibility&quot;;
        private const string KeyVisibilityLastUpdated = &quot;sensorberg_sdk_visibility_last_updated&quot;;

        private const int AppVisibilityFallbackDelayInSeconds = 60;
        private const string USERID = &quot;userid&quot;;

        private readonly ApplicationDataContainer _localSettings = ApplicationData.Current.LocalSettings;

        private static SDKData _instance;
        public static SDKData Instance
        {
            get
            {
                if (_instance == null)
                {
                    _instance = new SDKData();
                }

                return _instance;
            }
        }

        public string UserId
        {
            [DebuggerStepThrough]
            get
            {
                object id;
                ApplicationData.Current.LocalSettings.Values.TryGetValue(USERID, out id);
                string s = id as string;
                if (s == null)
                {
                    s = string.Empty;
                }
                return s;
            }
            [DebuggerStepThrough] set
            {
                string id = value;
                id = !string.IsNullOrEmpty(id) ? Uri.EscapeDataString(id) : string.Empty;
                ApplicationData.Current.LocalSettings.Values[USERID] = id;
            }
        }

        public string ApiKey
        {
            [DebuggerStepThrough]
            get
            {
                string apiKey = string.Empty;

                if (_localSettings.Values.ContainsKey(KeySensorbergSdkApiKey))
                {
                    apiKey = _localSettings.Values[KeySensorbergSdkApiKey].ToString();
                }

                return apiKey;
            }
            [DebuggerStepThrough]
            set
            {
                if (!_localSettings.Values.ContainsKey(KeySensorbergSdkApiKey)
                    || !_localSettings.Values[KeySensorbergSdkApiKey].Equals(value))
                {
                    _localSettings.Values[KeySensorbergSdkApiKey] = value;
                }
            }
        }

        public string DeviceId
        {
            [DebuggerStepThrough]
            get
            {
                if (!_localSettings.Values.ContainsKey(KeySensorbergSdkGuid))
                {
                    _localSettings.Values[KeySensorbergSdkGuid] = Guid.NewGuid().ToString();
                }

                return _localSettings.Values[KeySensorbergSdkGuid] + (string.IsNullOrEmpty(UserId) ? string.Empty : &quot;/&quot; + UserId);
            }
        }

        public string LayoutBeaconId1Hash
        {
            [DebuggerStepThrough]
            get
            {
                string hash = string.Empty;

                if (_localSettings.Values.ContainsKey(KeyLayoutBeaconId1Hash))
                {
                    hash = _localSettings.Values[KeyLayoutBeaconId1Hash].ToString();
                }

                return hash;
            }
            [DebuggerStepThrough]
            set
            {
                if (!_localSettings.Values.ContainsKey(KeyLayoutBeaconId1Hash)
                    || !_localSettings.Values[KeyLayoutBeaconId1Hash].Equals(value))
                {
                    _localSettings.Values[KeyLayoutBeaconId1Hash] = value;
                }
            }
        }

        public DateTimeOffset DatabaseCleaningTime
        {
            [DebuggerStepThrough]
            get
            {
                if (!_localSettings.Values.ContainsKey(KeyDatabaseCleaningTime))
                {
                    _localSettings.Values[KeyDatabaseCleaningTime] = DateTimeOffset.Now;
                }

                return (DateTimeOffset)_localSettings.Values[KeyDatabaseCleaningTime];
            }
            [DebuggerStepThrough]
            set
            {
                _localSettings.Values[KeyDatabaseCleaningTime] = value;
            }
        }

        public bool BackgroundTaskEnabled
        {
            [DebuggerStepThrough]
            get
            {
                if (!_localSettings.Values.ContainsKey(KeyBackgroundTaskEnabled))
                {
                    _localSettings.Values[KeyBackgroundTaskEnabled] = false;
                }

                return (bool)_localSettings.Values[KeyBackgroundTaskEnabled];
            }
            [DebuggerStepThrough]
            set
            {
                if (!_localSettings.Values.ContainsKey(KeyBackgroundTaskEnabled)
                    || !_localSettings.Values[KeyBackgroundTaskEnabled].Equals(value))
                {
                    _localSettings.Values[KeyBackgroundTaskEnabled] = value;
                }
            }
        }

        public bool BackgroundFilterUpdateRequired
        {
            [DebuggerStepThrough]
            get
            {
                if (!_localSettings.Values.ContainsKey(KeyBackgroundFilterUpdateRequired))
                {
                    _localSettings.Values[KeyBackgroundFilterUpdateRequired] = false;
                }

                return (bool)_localSettings.Values[KeyBackgroundFilterUpdateRequired];
            }
            [DebuggerStepThrough]
            set
            {
                if (!_localSettings.Values.ContainsKey(KeyBackgroundFilterUpdateRequired)
                    || !_localSettings.Values[KeyBackgroundFilterUpdateRequired].Equals(value))
                {
                    _localSettings.Values[KeyBackgroundFilterUpdateRequired] = value;
                }
            }
        }

        public bool AppIsVisible
        {
            [DebuggerStepThrough]
            get
            {
                if (_localSettings.Values.ContainsKey(KeyAppIsVisible))
                {
                    return (bool)_localSettings.Values[KeyAppIsVisible];
                }

                return false;
            }
            [DebuggerStepThrough]
            set
            {
                _localSettings.Values[KeyAppIsVisible] = value;
                _localSettings.Values[KeyVisibilityLastUpdated] = DateTimeOffset.Now;
            }
        }

        /// &lt;summary&gt;
        /// Returns next incremental ID. The ID is global to the application and the counter is not
        /// reset, when the application is restarted.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;The next incremental ID.&lt;/returns&gt;
        public int NextId()
        {
            if (!_localSettings.Values.ContainsKey(KeyIncrementalId))
            {
                _localSettings.Values[KeyIncrementalId] = 0;
            }

            int id = (int)_localSettings.Values[KeyIncrementalId];

            if (id &gt;= int.MaxValue || id &lt; 0)
            {
                // Start over
                id = 0;
            }

            _localSettings.Values[KeyIncrementalId] = id + 1;
            return id;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[46,13,46,14,0],[48,17,48,90,0],[49,17,49,41,0],[50,17,50,31,0],[51,17,51,18,0],[52,21,52,38,0],[53,17,53,18,0],[54,17,54,26,0],[55,13,55,14,0],[57,13,57,14,0],[58,17,58,35,0],[59,17,59,90,0],[60,17,60,75,0],[61,13,61,14,0],[68,13,68,14,0],[69,17,69,46,0],[71,17,71,79,0],[72,17,72,18,0],[73,21,73,87,0],[74,17,74,18,0],[76,17,76,31,0],[77,13,77,14,0],[93,13,93,14,0],[94,17,94,78,0],[95,17,95,18,0],[96,21,96,93,0],[97,17,97,18,0],[99,17,99,131,0],[100,13,100,14,0],[111,17,111,18,0],[112,21,112,85,0],[113,17,113,18,0],[119,13,119,14,0],[120,17,121,85,0],[122,17,122,18,0],[123,21,123,75,0],[124,17,124,18,0],[125,13,125,14,0],[142,13,142,14,0],[143,17,143,72,0],[144,13,144,14,0],[161,13,161,14,0],[162,17,163,87,0],[164,17,164,18,0],[165,21,165,77,0],[166,17,166,18,0],[167,13,167,14,0],[184,13,184,14,0],[185,17,186,96,0],[187,17,187,18,0],[188,21,188,86,0],[189,17,189,18,0],[190,13,190,14,0],[197,13,197,14,0],[198,17,198,72,0],[199,17,199,18,0],[200,21,200,73,0],[203,17,203,30,0],[204,13,204,14,0],[207,13,207,14,0],[208,17,208,64,0],[209,17,209,86,0],[210,13,210,14,0],[228,13,228,14,0],[230,17,230,24,0],[231,13,231,14,0],[32,13,32,14,1],[33,17,33,39,1],[34,17,34,18,1],[35,21,35,47,1],[36,17,36,18,1],[38,17,38,34,1],[39,13,39,14,1],[80,13,80,14,1],[81,17,82,85,1],[83,17,83,18,1],[84,21,84,75,1],[85,17,85,18,1],[86,13,86,14,1],[107,13,107,14,1],[108,17,108,44,1],[110,17,110,79,1],[115,17,115,29,1],[116,13,116,14,1],[132,13,132,14,1],[133,17,133,81,1],[134,17,134,18,1],[135,21,135,89,1],[136,17,136,18,1],[138,17,138,87,1],[139,13,139,14,1],[151,13,151,14,1],[152,17,152,82,1],[153,17,153,18,1],[154,21,154,77,1],[155,17,155,18,1],[157,17,157,78,1],[158,13,158,14,1],[174,13,174,14,1],[175,17,175,91,1],[176,17,176,18,1],[177,21,177,86,1],[178,17,178,18,1],[180,17,180,87,1],[181,13,181,14,1],[219,9,219,10,1],[220,13,220,70,1],[221,13,221,14,1],[222,17,222,61,1],[223,13,223,14,1],[225,13,225,67,1],[227,13,227,46,1],[233,13,233,62,1],[234,13,234,23,1],[235,9,235,10,1],[26,9,26,106,1]]);
    </script>
  </body>
</html>