<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>d:\work\sensorberg\windows10-sdk\sensorbergsdk\internal\utils\actionfactory.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.IO;
using System.Runtime.Serialization.Json;
using Windows.Data.Json;

namespace SensorbergSDK.Internal
{
    public sealed class ActionFactory
    {
        private static readonly string KeySubject = &quot;subject&quot;;
        private static readonly string KeyBody = &quot;body&quot;;
        private static readonly string KeyUrl = &quot;url&quot;;
        private static readonly string KeyPayload = &quot;payload&quot;;
        
        /// &lt;summary&gt;
        /// Parses and creates a beacon action instance from the given data.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;actionType&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;actionUuid&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;A newly created BeaconAction instance or null in case of a failure.&lt;/returns&gt;
        public static BeaconAction CreateBeaconAction(int actionType, JsonObject message, string actionUuid)
        {
            BeaconAction beaconAction = null;

            if (message != null)
            {
                JsonObject payload = null;
                IJsonValue jsonValue;

                if (message.TryGetValue(KeyPayload, out jsonValue))
                {
                    payload = JsonHelper.OptionalObject(message, KeyPayload);
                }

                switch (actionType)
                {
                    case Constants.ActionTypeUrlMessage:
                        beaconAction = new BeaconAction
                        {
                            Uuid = actionUuid,
                            Subject = message.GetNamedString(KeySubject),
                            Body = message.GetNamedString(KeyBody),
                            Url = message.GetNamedString(KeyUrl),
                            Payload = payload
                        };

                        beaconAction.SetType(Constants.ActionTypeUrlMessage);
                        break;

                    case Constants.ActionTypeVisitWebsite:
                        beaconAction = new BeaconAction
                        {
                            Uuid = actionUuid,
                            Subject = JsonHelper.OptionalString(message, KeySubject),
                            Body = JsonHelper.OptionalString(message, KeyBody),
                            Url = JsonHelper.OptionalString(message, KeyUrl),
                            Payload = payload
                        };

                        beaconAction.SetType(Constants.ActionTypeVisitWebsite);
                        break;

                    case Constants.ActionTypeInApp:
                        beaconAction = new BeaconAction
                        {
                            Uuid = actionUuid,
                            Subject = JsonHelper.OptionalString(message, KeySubject),
                            Body = JsonHelper.OptionalString(message, KeyBody),
                            Url = JsonHelper.OptionalString(message, KeyUrl),
                            Payload = payload
                        };

                        beaconAction.SetType(Constants.ActionTypeInApp);
                        break;
                }
            }

            return beaconAction;
        }

        /// &lt;summary&gt;
        /// Serializes the given BeaconAction instance.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;beaconAction&quot;&gt;The instance to serialize.&lt;/param&gt;
        /// &lt;returns&gt;The serialized instance as string.&lt;/returns&gt;
        public static string Serialize(BeaconAction beaconAction)
        {
            string serializedBeaconAction = string.Empty;

            if (beaconAction != null)
            {
                MemoryStream stream = new MemoryStream();
                DataContractJsonSerializer serializer = new DataContractJsonSerializer(typeof(BeaconAction));
                bool success = false;

                try
                {
                    serializer.WriteObject(stream, beaconAction);
                    success = true;
                }
                catch (Exception)
                {
                }

                stream.Position = 0;
                StreamReader streamReader = new StreamReader(stream);

                if (success)
                {
                    try
                    {
                        serializedBeaconAction = streamReader.ReadToEnd();
                    }
                    catch (Exception)
                    {
                    }

                    System.Diagnostics.Debug.WriteLine(&quot;ActionFactory.Serialize(): &quot; + serializedBeaconAction);
                }
            }

            return serializedBeaconAction;
        }

        /// &lt;summary&gt;
        /// Deserializes the given serialized BeaconAction.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;serializedBeaconAction&quot;&gt;The serialized BeaconAction as string.&lt;/param&gt;
        /// &lt;returns&gt;The deserialized BeaconAction instance.&lt;/returns&gt;
        public static BeaconAction Deserialize(string serializedBeaconAction)
        {
            DataContractJsonSerializer serializer = new DataContractJsonSerializer(typeof(BeaconAction));
            var stream = new MemoryStream(System.Text.Encoding.UTF8.GetBytes(serializedBeaconAction));
            return (BeaconAction)serializer.ReadObject(stream);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[88,9,88,10,0],[89,13,89,58,0],[91,13,91,38,0],[92,13,92,14,0],[93,17,93,58,0],[94,17,94,110,0],[95,17,95,38,0],[98,17,98,18,0],[99,21,99,66,0],[100,21,100,36,0],[101,17,101,18,0],[102,17,102,34,0],[103,17,103,18,0],[104,17,104,18,0],[106,17,106,37,0],[107,17,107,70,0],[109,17,109,29,0],[110,17,110,18,0],[112,21,112,22,0],[113,25,113,75,0],[114,21,114,22,0],[115,21,115,38,0],[116,21,116,22,0],[117,21,117,22,0],[119,21,119,112,0],[120,17,120,18,0],[121,13,121,14,0],[123,13,123,43,0],[124,9,124,10,0],[132,9,132,10,0],[133,13,133,106,0],[134,13,134,103,0],[135,13,135,64,0],[136,9,136,10,0],[23,9,23,10,1],[24,13,24,46,1],[26,13,26,33,1],[27,13,27,14,1],[28,17,28,43,1],[31,17,31,68,1],[32,17,32,18,1],[33,21,33,78,1],[34,17,34,18,1],[36,17,36,36,1],[39,25,46,27,1],[48,25,48,78,1],[49,25,49,31,1],[52,25,59,27,1],[61,25,61,80,1],[62,25,62,31,1],[65,25,72,27,1],[74,25,74,73,1],[75,25,75,31,1],[77,13,77,14,1],[79,13,79,33,1],[80,9,80,10,1],[10,9,10,63,1],[11,9,11,57,1],[12,9,12,55,1],[13,9,13,63,1]]);
    </script>
  </body>
</html>