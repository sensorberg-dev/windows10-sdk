<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>d:\work\sensorberg\windows10-sdk\sensorbergsdk\appsettings.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Diagnostics;
using System.Globalization;
using System.Runtime.Serialization;
using Windows.Data.Json;
using SensorbergSDK.Internal;

namespace SensorbergSDK
{
    [DataContract]
    public sealed class AppSettings
    {
        private const string BEACON_EXIT_TIMEOUT_KEY = &quot;scanner.exitTimeoutMillis&quot;;
        private const string HISTORY_UPLOAD_INTERVAL_KEY = &quot;network.historyUploadInterval&quot;;
        private const string RSSI_ENTER_THRESHOLD_KEY = &quot;scanner.enterRssiThreshold&quot;;
        private const string ENTER_DISTANCE_THRESHOLD_KEY = &quot;scanner.enterDistanceThreshold&quot;;
        private const string LAYOUT_UPDATE_INTERVAL_KEY = &quot;network.beaconLayoutUpdateInterval&quot;;
        private const string SETTINGS_UPDATE_INTERVAL_KEY = &quot;settings.updateTime&quot;;

        [DataMember(Name = &quot;scanner.exitTimeoutMillis&quot;)]
        public UInt64 BeaconExitTimeout { get; set; }

        [DataMember(Name = &quot;network.historyUploadInterval&quot;)]
        public UInt64 HistoryUploadInterval { get; set; }

        [DataMember(Name = &quot;scanner.enterRssiThreshold&quot;)]
        public Int16? RssiEnterThreshold { get; set; }

        [DataMember(Name = &quot;scanner.enterDistanceThreshold&quot;)]
        public UInt64? EnterDistanceThreshold { get; set; }

        [DataMember(Name = &quot;network.beaconLayoutUpdateInterval&quot;)]
        public UInt64 LayoutUpdateInterval { get; set; }

        [DataMember(Name = &quot;settings.updateTime&quot;)]
        public UInt64 SettingsUpdateInterval { get; set; }

        /// &lt;summary&gt;
        /// Creates an appsettings object, including the basic setup.
        /// &lt;/summary&gt;
        public AppSettings()
        {
            BeaconExitTimeout = Constants.DefaultBeaconExitTimeout;
            SettingsUpdateInterval = Constants.DefaultSettingsUpdateInterval;
            HistoryUploadInterval = Constants.DefaultHistoryUploadInterval;
            LayoutUpdateInterval = Constants.DefaultLayoutUpdateInterval;
        }

        public static AppSettings FromJson(JsonObject json)
        {
            AppSettings settings = new AppSettings();

            Debug.WriteLine(&quot;Settings json = &quot; + json);

            if (json.ContainsKey(BEACON_EXIT_TIMEOUT_KEY))
            {
                var exitTimeout = json[BEACON_EXIT_TIMEOUT_KEY];
                settings.BeaconExitTimeout = exitTimeout.ValueType == JsonValueType.Null ? Constants.DefaultBeaconExitTimeout : Convert.ToUInt64(GetValueAsString(exitTimeout));
            }
            else
            {
                settings.BeaconExitTimeout = Constants.DefaultBeaconExitTimeout;
            }

            if (json.ContainsKey(HISTORY_UPLOAD_INTERVAL_KEY))
            {
                var historyInterval = json[HISTORY_UPLOAD_INTERVAL_KEY];
                settings.HistoryUploadInterval = historyInterval.ValueType == JsonValueType.Null ? Constants.DefaultHistoryUploadInterval : Convert.ToUInt64(GetValueAsString(historyInterval));
            }
            else
            {
                settings.HistoryUploadInterval = Constants.DefaultHistoryUploadInterval;
            }

            if (json.ContainsKey(RSSI_ENTER_THRESHOLD_KEY))
            {
                var rssiEnterThreshold = json[RSSI_ENTER_THRESHOLD_KEY];
                if (rssiEnterThreshold.ValueType != JsonValueType.Null)
                {
                    settings.RssiEnterThreshold = Convert.ToInt16(GetValueAsString(rssiEnterThreshold));
                }
            }

            if (json.ContainsKey(ENTER_DISTANCE_THRESHOLD_KEY))
            {
                var enterDistanceThreshold = json[ENTER_DISTANCE_THRESHOLD_KEY];
                if (enterDistanceThreshold.ValueType != JsonValueType.Null)
                {
                    settings.EnterDistanceThreshold =
                        Convert.ToUInt64(GetValueAsString(enterDistanceThreshold));
                }
            }

            if (json.ContainsKey(LAYOUT_UPDATE_INTERVAL_KEY))
            {
                var layoutUpdateInterval = json[LAYOUT_UPDATE_INTERVAL_KEY];
                settings.LayoutUpdateInterval = layoutUpdateInterval.ValueType == JsonValueType.Null ? Constants.DefaultLayoutUpdateInterval : Convert.ToUInt64(GetValueAsString(layoutUpdateInterval));
            }
            else
            {
                settings.LayoutUpdateInterval = Constants.DefaultLayoutUpdateInterval;
            }

            if (json.ContainsKey(SETTINGS_UPDATE_INTERVAL_KEY))
            {
                var settingsUpdateInterval = json[SETTINGS_UPDATE_INTERVAL_KEY];
                settings.SettingsUpdateInterval = settingsUpdateInterval.ValueType == JsonValueType.Null ? Constants.DefaultSettingsUpdateInterval : Convert.ToUInt64(GetValueAsString(settingsUpdateInterval));
            }
            else
            {
                settings.SettingsUpdateInterval = Constants.DefaultSettingsUpdateInterval;
            }

            return settings;
        }

        private static string GetValueAsString(IJsonValue enterDistanceThreshold)
        {
            return enterDistanceThreshold.ValueType == JsonValueType.String
                ? enterDistanceThreshold.GetString()
                : enterDistanceThreshold.GetNumber().ToString(CultureInfo.InvariantCulture);
        }

        public override string ToString()
        {
            return $&quot;BeaconExitTimeout = {BeaconExitTimeout}, HistoryUploadInterval = {HistoryUploadInterval}, RssiEnterThreshold = {RssiEnterThreshold}, EnterDistanceThreshold = {EnterDistanceThreshold}, LayoutUpdateInterval = {LayoutUpdateInterval}, SettingsUpdateInterval = {SettingsUpdateInterval}&quot;;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[27,49,27,53,0],[30,54,30,58,0],[50,9,50,10,0],[51,13,51,54,0],[53,13,53,56,0],[55,13,55,59,0],[56,13,56,14,0],[57,17,57,65,0],[58,17,58,177,0],[59,13,59,14,0],[61,13,61,14,0],[62,17,62,81,0],[63,13,63,14,0],[65,13,65,63,0],[66,13,66,14,0],[67,17,67,73,0],[68,17,68,193,0],[69,13,69,14,0],[71,13,71,14,0],[72,17,72,89,0],[73,13,73,14,0],[75,13,75,60,0],[76,13,76,14,0],[77,17,77,73,0],[78,17,78,72,0],[79,17,79,18,0],[80,21,80,105,0],[81,17,81,18,0],[82,13,82,14,0],[84,13,84,64,0],[85,13,85,14,0],[86,17,86,81,0],[87,17,87,76,0],[88,17,88,18,0],[89,21,90,84,0],[91,17,91,18,0],[92,13,92,14,0],[94,13,94,62,0],[95,13,95,14,0],[96,17,96,77,0],[97,17,97,201,0],[98,13,98,14,0],[100,13,100,14,0],[101,17,101,87,0],[102,13,102,14,0],[104,13,104,64,0],[105,13,105,14,0],[106,17,106,81,0],[107,17,107,209,0],[108,13,108,14,0],[110,13,110,14,0],[111,17,111,91,0],[112,13,112,14,0],[114,13,114,29,0],[115,9,115,10,0],[118,9,118,10,0],[119,13,121,93,0],[122,9,122,10,0],[21,43,21,47,1],[21,48,21,52,1],[24,47,24,51,1],[24,52,24,56,1],[27,44,27,48,1],[30,49,30,53,1],[33,46,33,50,1],[33,51,33,55,1],[36,48,36,52,1],[36,53,36,57,1],[41,9,41,29,1],[42,9,42,10,1],[43,13,43,68,1],[44,13,44,78,1],[45,13,45,76,1],[46,13,46,74,1],[47,9,47,10,1],[125,9,125,10,1],[126,13,126,304,1],[127,9,127,10,1]]);
    </script>
  </body>
</html>